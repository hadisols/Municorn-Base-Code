<aura:component
    implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes,force:lightningQuickActionWithoutHeader"
    access="global" controller="PMA_ProductsController">

    <!--Aura Attributes START-->
    <aura:handler name="init" value="{!this}" action="{!c.onInit}" />
    <!--Init Parent Component Values-->
    <aura:attribute name="memberId" type="String" />
    <aura:attribute name="orderUUID" type="String" />
    <aura:attribute name="memberName" type="String" />
    <aura:attribute name="pmaContainer" type="Aura.Component"/>

    <!-- Init() Loggend in User Record Details -->
    <aura:attribute name="userInfo" type="User"/> 
    
    <aura:attribute name="orderRecord" type="Order__C" />
    <aura:attribute name="orderItemRecord" type="List" />

    <aura:attribute name="transactionId" type="String" />
    
    <!-- Store Incoming Message of Map<Id,Wrapper> -->
    <aura:attribute name="selectedproductsString" type="String" />
    <!-- **EventVariable** Store Selected Products Values to Itereate over Products and Set This for inbound-->
    <aura:attribute name="selectedProductsValues" type="List" />
    <aura:attribute name="totalChargeAmount" type="Decimal" default="0"/>

     <!-- Info:: Log Incoming Event Message-->    
     <aura:attribute name="messageFromEvent" type="String"/>
     <!-- Info::Count No Of Times Event Fired -->
     <aura:attribute name="numEvents" type="Integer" default="0"/>

    <!-- Register for Cart Product Deletion Application Event -->
    <aura:registerEvent name="cartEvent" type="c:cartCommunicationEvent"/>
    <!-- Handler for Products Selection Application Event -->
    <aura:handler event="c:posCommunicationEvent" action="{!c.handleProductSelectionEvent}"/>
    <!-- Register for Communications Application Event -->
    <aura:registerEvent name="communicateEvent" type="c:componentCommunicationEvent"/>

    <aura:attribute name="loaded" type="Boolean" default="false" />
    <!--Aura Attributes END-->

     <!--Start Bootstrap Cart markup-->
     <div class="sfappwrapper">
        <div class="slds-card cartcontainer">
            <section class="h-100 h-custom">
                <div class="container py-1 h-100">
                    <div class="row slds-grid slds-grid_align-center slds-grid_vertical-align-center h-100">
                        <div class="col">
                            <div class="card border-0 height72">
                                <div class="card-body p-0">

                                    <div class="row">

                                        <div class="col-lg-12 p-0">
                                            <h5 class="mb-3 text-body text-center">{!v.memberName}</h5>
                                            <h5 class="mb-3 text-body text-center">Cart Items</h5>
                                            <hr/>
                                            <div class="cartitemsList listscroll-y">
                                                <aura:if isTrue="{! (v.orderItemRecord.length > 0 ) }">
                                                    <h6 class="mb-3 text-body text-center">Served Items</h6>
                                                    <hr/>
                                                    <aura:iteration items="{!v.orderItemRecord}" var="orderLineItem" indexVar="key">
                                                        <div class="card mb-3 border-0 orderlineitem-container" data-id="{!orderLineItem.Product__c}">
                                                            <div class="card-body p-0">
                                                                <div class="slds-grid slds-grid_align-spread">
                                                                    <div class="slds-grid slds-wrap slds-grid_align-center flex-shrink-1">
                                                                        <div class="cartitemname">
                                                                            <h5 class="slds-truncate mb-0 sm-text-highlight skyblue-text pl-5px">{!orderLineItem.Product_Name__c}<span> x </span>{!orderLineItem.Quantity__c}</h5>
                                                                        </div>
                                                                    </div>
                                                                    <div class="slds-grid slds-grid_align-end slds-grid_vertical-align-center w-100 px-1">
                                                                        <!-- <div style="width: 50px;">
                                                                            <h5 class="fw-normal mb-0">2</h5>
                                                                        </div> -->
                                                                        <h5 class="mb-0 px-2 sm-text-highlight grey-text">$ <lightning:formattedNumber value="{!orderLineItem.Total_Price__c}" minimumFractionDigits="2" maximumFractionDigits="2" currencyCode="USD"/></h5>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <hr/>
                                                    </aura:iteration>  
                                                </aura:if>
                                                <hr/>
                                                
                                                <aura:if isTrue="{! and(!empty(v.selectedProductsValues),(v.selectedProductsValues.length > 0 ) )}">
                                                    <h6 class="mb-3 text-body text-center">New Items</h6>
                                                    <hr/>
                                                    <aura:iteration items="{!v.selectedProductsValues}" var="selectedproduct" indexVar="key">
                                                        <div class="card mb-3 border-0" data-id="{!selectedproduct.product.Id}" onclick="{!c.productDeleteHandler}">
                                                            <div class="card-body p-0">
                                                                <div class="slds-grid slds-grid_align-spread">
                                                                    <div class="slds-grid slds-wrap slds-grid_align-center flex-shrink-1">
                                                                        <div class="cartitemname">
                                                                            <h5 class="slds-truncate mb-0 sm-text-highlight skyblue-text pl-5px">{!selectedproduct.product.Name}<span> x </span>{!selectedproduct.quantity}</h5>
                                                                        </div>
                                                                    </div>
                                                                    <div class="slds-grid slds-wrap slds-grid_align-end slds-grid_vertical-align-center w-100 px-1">
                                                                        <!-- <div style="width: 50px;">
                                                                            <h5 class="fw-normal mb-0">2</h5>
                                                                        </div> -->
                                                                        <h5 class="mb-0 px-2 sm-text-highlight grey-text">$ <lightning:formattedNumber value="{!selectedproduct.totalProductPrice}" minimumFractionDigits="2" maximumFractionDigits="2" currencyCode="USD"/></h5>
                                                                        <div class="slds-text-color_destructive">
                                                                            <i class="fas fa-trash-alt"></i>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <hr/>
                                                    </aura:iteration>  
                                                </aura:if>
                                            </div>
                                            <aura:if isTrue="{! and( empty(v.selectedProductsValues) , ( (v.orderItemRecord.length == 0)||(v.orderItemRecord==undefined) ) ) }">
                                                <div class="card mb-3 border-0">
                                                    <div class="card-body px-1 py-1">
                                                        <div class="slds-grid slds-grid_align-center">
                                                            <div class="slds-grid slds-wrap slds-grid_align-center flex-shrink-1">
                                                                <div class="ms-3">
                                                                    <h5 class="slds-truncate mb-0 sm-text-highlight skyblue-text">Cart is Empty</h5>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <hr/>
                                            </aura:if>
                                        </div>
                                    </div>
                                </div>
                                
                                    <div class="slds-grid slds-wrap slds-grid_align-center py-3 py-3">
                                        <div class="slds-grid slds-wrap slds-grid_align-center slds-grid_vertical-align-center flex-shrink-1 flex-row-gap-10px">
                                            <aura:if isTrue="{! !empty(v.selectedProductsValues)}">
                                                <button class="btn btn-info btn-md mx-2" onclick="{! c.handleFinialize }">
                                                    <i class="fa fa-shopping-cart" aria-hidden="true"></i>
                                                    Add to Order    
                                                </button>
                                            </aura:if>
                                            <aura:if isTrue="{! (v.orderItemRecord.length > 0)}">
                                                <button class="btn btn-success btn-md mx-2" onclick="{! c.handleCharge }">
                                                    <i class="fa fa-credit-card" aria-hidden="true"></i>
                                                    Close Tab     
                                                </button>
                                            </aura:if>
                                            <button class="btn btn-danger btn-md" onclick="{! c.returnBacktoSearch }">
                                                <i class="fa fa-times" aria-hidden="true"></i>
                                                Cancel     
                                            </button>
                                        </div>
                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
    <!-- End Bootstrap Cart markup -->
</aura:component>